<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Print Spooler on Trusselsky</title>
    <link>https://trusselsky.github.io/tags/print-spooler/</link>
    <description>Recent content in Print Spooler on Trusselsky</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Tue, 27 Jul 2021 16:33:39 +0200</lastBuildDate>
    
	<atom:link href="https://trusselsky.github.io/tags/print-spooler/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>PrintNightmare - CVE-2021-34527</title>
      <link>https://trusselsky.github.io/posts/printnightmare/</link>
      <pubDate>Tue, 27 Jul 2021 16:33:39 +0200</pubDate>
      
      <guid>https://trusselsky.github.io/posts/printnightmare/</guid>
      <description>&lt;h3 id=&#34;hva-er-det&#34;&gt;Hva er det?&lt;/h3&gt;
&lt;p&gt;Den 30 Juli, ble det avdekket en s친rbarhet i Print Spooler tjenesten i Windows. Som er en innebygget tjeneste i Windows som h친ndterer utskrift samt er ogs친 ansvarlig for driver innstallasjon knyttet til oppkobling av skrivere p친 Windows operativsystem.&lt;/p&gt;
&lt;p&gt;Det har kommet en del informasjon knyttet til denne s친rbarheten samtidig som den er veldig omfattende og dekkes av flere CVE&amp;rsquo;er.&lt;/p&gt;
&lt;p&gt;1: CVE-2021-1675 (&lt;a href=&#34;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675&#34;&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675&lt;/a&gt;) som ikke er s친rbarheten dubbet PrintNightmare. Microsoft kom med egen patch for denne med m친nedlig oppdateringer i Juli.&lt;br&gt;
2: CVE-2021-34527 (&lt;a href=&#34;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527&#34;&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527&lt;/a&gt;) har ogs친 kommet med egne patcher for de ulike operativsystemene.&lt;br&gt;
3: CVE-2021-34481 (&lt;a href=&#34;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34481&#34;&gt;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34481&lt;/a&gt;) ny s친rbarhet for lokal eskalering av tilganger. (Egen artikkel, kom 16 Juli)&lt;/p&gt;
&lt;h3 id=&#34;hvilken-versjoner-gjelder-det&#34;&gt;Hvilken versjoner gjelder det?&lt;/h3&gt;
&lt;p&gt;Denne s친rbarheten gjelder alle Windows Operativsystem (b친de klient og Server) fra Windows 7/2008 til Windows 10/2019.&lt;/p&gt;
&lt;h3 id=&#34;hvilken-konsekvenser-har-det&#34;&gt;Hvilken konsekvenser har det?&lt;/h3&gt;
&lt;p&gt;Denne s친rbarheten kan gj칮re det mulig 친 kompromitere maskiner i gitte scenarioer hvor man har Print Spooler tjenesten kj칮rende. Dette kan da v칝re nettverksbaserte maskiner som domene kontrollere eller andre typer maskiner. Print Spooler tjenesten kj칮rer som standard. Svakheten er definert slik at man kan lage en egendefinert DLL fil (som gjenspeiler en Print Driver) som man kan f친 print tjenesten i Windows til 친 importere under SYSTEM kontekst om Remote Printing tjenestne er aktivert. Denne egendefinerte DLL filen kan f.eks inneholde skjulte kommandoer for 친 tildele f.eks lokal administrator tilgang.  Basert p친 informasjon vi har tilgjengelig er det ingen aktive angrep som benytter seg av denne angrepsvektoren enn친. Det krever tilgang til f.eks en maskin innenfor domenet for 친 kunne utnytte seg av s친rbarheten som en da autentisert bruker.&lt;/p&gt;
&lt;h3 id=&#34;l칮sningerworkarounds&#34;&gt;L칮sninger/Workarounds&lt;/h3&gt;
&lt;p&gt;Microsoft har kommet med sikkerhetsoppdateringer som l칮ser s친rbarheten. Men pga flere s친rbarheter som n친 blir avdekket i Print Spooler tjenesten, samt generell r친d er at man deaktiverer Print Spooler tjenesten p친 maskiner som ikke har behov for den, som f.eks Domene kontrollere.  Merk at sikkerhetsoppdateringene fra Microsoft krever omstart av maskinene som blir oppdatert.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PowerShell eksempel&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;Stop-Service -Name Spooler -Force
Set-Service -Name Spooler -StartupType Disabled
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Merk at ved 친 deaktivere Print Spooler tjenesten vil stoppe muligheten for 친 kj칮re print jobber, dette omfatter ogs친 f.eks konvertering til PDF. For maskiner hvor man har behov for print som f.eks Citrix servere eller lokale arbeidsstasjoner er det anbefalt at man deaktiverer inbound remote print for 친 kunne&lt;/p&gt;
&lt;h3 id=&#34;mer-informasjon&#34;&gt;Mer informasjon&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Eksempler p친 exploit &lt;a href=&#34;https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527&#34;&gt;https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Her er ogs친 et eksempel p친 hvordan man kan koble opp til en ekstern fiktiv print tjeneste som deretter gir System tilganger p친 maskinen. Merk at skaperen bak Mimikatz skriver ogs친 hvordan man kan begrense dette til kun godkjente systemer ogs친 via Group Policy.
&lt;blockquote class=&#34;twitter-tweet&#34;&gt;&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;Want to test &lt;a href=&#34;https://twitter.com/hashtag/printnightmare?src=hash&amp;amp;ref_src=twsrc%5Etfw&#34;&gt;#printnightmare&lt;/a&gt; (ep 4.x) user-to-system as a service?游볳&lt;br&gt;(POC only, will write a log file to system32)&lt;br&gt;&lt;br&gt;connect to \\&lt;a href=&#34;https://t.co/6Pk2UnOXaG&#34;&gt;https://t.co/6Pk2UnOXaG&lt;/a&gt; with&lt;br&gt;- user: .\gentilguest&lt;br&gt;- password: password&lt;br&gt;&lt;br&gt;Open &amp;#39;Kiwi Legit Printer - x64&amp;#39;, then &amp;#39;Kiwi Legit Printer - x64 (another one)&amp;#39; &lt;a href=&#34;https://t.co/zHX3aq9PpM&#34;&gt;pic.twitter.com/zHX3aq9PpM&lt;/a&gt;&lt;/p&gt;&amp;mdash; 游볳 Benjamin Delpy (@gentilkiwi) &lt;a href=&#34;https://twitter.com/gentilkiwi/status/1416429860566847490?ref_src=twsrc%5Etfw&#34;&gt;July 17, 2021&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;https://platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description> 
    </item>
    
  </channel>
</rss>