[{"content":"Som en del av Windows 11, har Microsoft introdusert en del rekke endringer i forhold til sikkerhet og hardware krav som f√∏lger de sikkerhetsfunksjonene. En av de st√∏rste endringene er at Microsft n√• vil kreve at maskiner som skal kj√∏re Windows 11 p√• fysiske maskiner, st√∏tter en funksjon i Windows som heter Measured Boot.\nMeasured Boot Measured Boot er delt opp i 2 deler, ene som er Secure Boot prosessen som ble laget for at operativsystemet kun starter opp med programvare som leverand√∏ren kan stole p√•. N√•r maskinen starter Secure boot vil den f√∏rste finne OS Bootloader partisjonen, verifisere at firmwaren er digital signert samt at den ikke er modifisert. Om innholdet er inntakt vil den deretter starte operativsystemet. Andre delen som kalles Trusted Boot sjekker integriteten av alle Windows baserte komponenter (samt ELAM \u0026ldquo;Early Launch Anti-Malware\u0026rdquo; sjekker at alle drivere er digital signerte f√∏r de blir lastet inn i bruker kontekst).\nNB: Secure Boot er en funksjon som ligger i UEFI √• ikke noe Microsoft har utviklet.\nFor √• kunne bruke Measured Boot (m/Secure boot) i Windows krever to ting, det ene er UEFI firmware samt TPM p√• maskinen.\nHva slags angrep stopper denne tjenesten? Selve sikkerhetsmekanismen er beregnet p√• √• stoppe Bootkits og RootKits. Bootkits er skadelig kode som starter f√∏r selve operativsystemet laster inn som gj√∏r at om man skulle bli infisert av en Bootkit, kan koden ligge i maskinen og overleve reinnstallasjon av operativsystem blant annet. Trickbot er en malware akt√∏r som benytter seg av Bootkit som de har kalt TrickBoot (Man kan lese mer om det her \u0026ndash;\u0026gt; https://eclypsium.com/2020/12/03/trickbot-now-offers-trickboot-persist-brick-profit/)\nSamt med ELAM og verifisering av Windows komponenter kan man ogs√• unng√• Rootkits ved at anti-virus tjenesten kan starte f√∏r en eventuelt Rootkit som ofte starter som en prosess eller scheduled task kan starte.\nSelvsagt viktig √• p√•peke at disse sikkerhetsfunksjonene vil ikke ha noe direkte effekt mot f.eks ransomware angrep, hvor angripere ofte angriper kj√∏rende maskiner ved √• utnytte andre s√•rbarheter. Men dette er rettet mot f.eks mot fysisk angrep hvor noen pr√∏ver √• modifisere boot prosessen.\nHvorfor er disse TPM kravene her? S√• trenger jeg virkelig TPM? √• i tilfelle hvilken versjon trenger jeg? Microsoft har endret litt p√• kravene sine, s√• for √• f√• lov til √• innstallere Windows 11 m√• man ha st√∏tte for ihvertfall TPM 1.2 eller h√∏yere.\nTPM 1.2 standaren ble ferdig i 2011 s√• mange av dagens maskiner har\nMan kan ogs√• sl√• av denne sjekken under installasjon ved √• legge til en enkel registry n√∏kkel p√• maskinen. Ved innstallasjon trykk Shift+F10, √•pne registry og legg til n√∏kkel\nHKEY_LOCAL_MACHINE\\SYSTEM\\Setup ‚ÄúBypassTPMCheck‚Äù=dword:00000001 ‚ÄúBypassSecureBootCheck‚Äù=dword:00000001 Microsoft anbefaler at man helst har TPM 2.0 chip p√• maskinene pga det er en stor l√∏ft fra TPM 1.2 til TPM 2.0 \u0026ndash;\u0026gt; (https://docs.microsoft.com/en-us/windows/security/information-protection/tpm/tpm-recommendations#tpm-12-vs-20-comparison)\nAndre funksjoner som vil kreve dette Microsoft √∏nsker ogs√• √• kunne benytte denne funskjonen som en autentiseringsfaktor ogs√•. Mange av tilgangsmekanismene som i dag finnes i Azure AD er basert p√• enten bruker m/tofator autentisering. Men i bunnen av Windows 11 har Microsoft ogs√• utviklet en ny funksjon for utveksling av helse status p√• maskinen.\nSom betyr f.eks at Windows 11 maskiner kan sende helse signal til Azure AD ved √• gi beskjed om status i forhold til Secure Boot f√∏r f.eks en enhet f√•r tilgang til data og tjenester, men dette er noe som kommer p√• sikt.\nMer informasjon NSA har ogs√• laget en god oppsummering p√• UEFI og Secure Boot prosessen \u0026ndash;\u0026gt; https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF\n","permalink":"https://trusselsky.github.io/posts/windows11ogsecureboot/","summary":"Som en del av Windows 11, har Microsoft introdusert en del rekke endringer i forhold til sikkerhet og hardware krav som f√∏lger de sikkerhetsfunksjonene. En av de st√∏rste endringene er at Microsft n√• vil kreve at maskiner som skal kj√∏re Windows 11 p√• fysiske maskiner, st√∏tter en funksjon i Windows som heter Measured Boot.\nMeasured Boot Measured Boot er delt opp i 2 deler, ene som er Secure Boot prosessen som ble laget for at operativsystemet kun starter opp med programvare som leverand√∏ren kan stole p√•.","title":"Windows 11 og Measured Boot m/TPM"},{"content":"U.S. Cybersecurity og Infrastructure Security Agency (CISA) har sammen laget en liste med de (top 30) vanligste s√•rbarhetene som blir utnyttet i angrep, basert p√• historiske data fra 2020 (samt s√•langt i 2021)\nDu kan se listen over de ulike s√•rbarheten her \u0026ndash;\u0026gt; https://us-cert.cisa.gov/ncas/alerts/aa21-209a PDF utgave her \u0026ndash;\u0026gt; https://us-cert.cisa.gov/sites/default/files/publications/AA21-209A_Joint%20CSA_Top%20Routinely%20Exploited%20Vulnerabilities.pdf\nS√•rbarhetene kommer fra en ulike rekke leverand√∏rer. Basert p√• historikk data fra 2020, er f√∏lgende de meste utnyttet s√•rbarhetene:\n Citrix - CVE-2019-19781 - arbitrary code execution Pulse - CVE 2019-11510 - arbitrary file reading Fortinet - CVE 2018-13379 - path traversal F5- Big IP - CVE 2020-5902 - remote code execution (RCE) MobileIron - CVE 2020-15505 - RCE Microsoft - CVE-2017-11882 - RCE Atlassian - CVE-2019-11580 - RCE Drupal - CVE-2018-7600 - RCE Telerik - CVE 2019-18935 - RCE Microsoft - CVE-2019-0604 - RCE Microsoft - CVE-2020-0787 - elevation of privilege Microsoft - CVE-2020-1472 - elevation of privilege  Vi s√• blant annet at Citrix s√•rbarheten alene kunne p√•virke opptil 850 organisasjoner i Norge. Samt blant annet CVE-2021-26855 (Microsoft Exchange) som ble utnyttet mot Stortinget som gjorde det mulig for angripere √• hente ut Epost kontoer fra den lokale Exchange databasen ved √• kj√∏re egendefinert kode mot OWA/EXC.\nI 2021 fortsetter angripere √• benytte seg av m√•lrettet s√•rbarheter mot enheter/tjenester som er offentlig tilgjengelig. Blant de som er sv√¶rt utnyttet s√• langt i 2021, er s√•rbarheter i Microsoft, Pulse, Accellion, VMware og Fortinet.\nDe har ogs√• kompilert en liste over de ulike CVEene med tiltak man kan gj√∏re for √• fikse opp i de ulike s√•rbarhetene.\n","permalink":"https://trusselsky.github.io/posts/mestutnyttets%C3%A5rbarheter/","summary":"U.S. Cybersecurity og Infrastructure Security Agency (CISA) har sammen laget en liste med de (top 30) vanligste s√•rbarhetene som blir utnyttet i angrep, basert p√• historiske data fra 2020 (samt s√•langt i 2021)\nDu kan se listen over de ulike s√•rbarheten her \u0026ndash;\u0026gt; https://us-cert.cisa.gov/ncas/alerts/aa21-209a PDF utgave her \u0026ndash;\u0026gt; https://us-cert.cisa.gov/sites/default/files/publications/AA21-209A_Joint%20CSA_Top%20Routinely%20Exploited%20Vulnerabilities.pdf\nS√•rbarhetene kommer fra en ulike rekke leverand√∏rer. Basert p√• historikk data fra 2020, er f√∏lgende de meste utnyttet s√•rbarhetene:\n Citrix - CVE-2019-19781 - arbitrary code execution Pulse - CVE 2019-11510 - arbitrary file reading Fortinet - CVE 2018-13379 - path traversal F5- Big IP - CVE 2020-5902 - remote code execution (RCE) MobileIron - CVE 2020-15505 - RCE Microsoft - CVE-2017-11882 - RCE Atlassian - CVE-2019-11580 - RCE Drupal - CVE-2018-7600 - RCE Telerik - CVE 2019-18935 - RCE Microsoft - CVE-2019-0604 - RCE Microsoft - CVE-2020-0787 - elevation of privilege Microsoft - CVE-2020-1472 - elevation of privilege  Vi s√• blant annet at Citrix s√•rbarheten alene kunne p√•virke opptil 850 organisasjoner i Norge.","title":"Vanligste s√•rbarhetene i 2020/2021"},{"content":"","permalink":"https://trusselsky.github.io/artikler/","summary":"","title":"Artikler"},{"content":"Hva er det? Den 30 Juli, ble det avdekket en s√•rbarhet i Print Spooler tjenesten i Windows. Som er en innebygget tjeneste i Windows som h√•ndterer utskrift samt er ogs√• ansvarlig for driver innstallasjon knyttet til oppkobling av skrivere p√• Windows operativsystem.\nDet har kommet en del informasjon knyttet til denne s√•rbarheten samtidig som den er veldig omfattende og dekkes av flere CVE\u0026rsquo;er.\n1: CVE-2021-1675 (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675) som ikke er s√•rbarheten dubbet PrintNightmare. Microsoft kom med egen patch for denne med m√•nedlig oppdateringer i Juli.\n2: CVE-2021-34527 (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527) har ogs√• kommet med egne patcher for de ulike operativsystemene.\n3: CVE-2021-34481 (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34481) ny s√•rbarhet for lokal eskalering av tilganger. (Egen artikkel, kom 16 Juli)\nHvilken versjoner gjelder det? Denne s√•rbarheten gjelder alle Windows Operativsystem (b√•de klient og Server) fra Windows 7/2008 til Windows 10/2019.\nHvilken konsekvenser har det? Denne s√•rbarheten kan gj√∏re det mulig √• kompromitere maskiner i gitte scenarioer hvor man har Print Spooler tjenesten kj√∏rende. Dette kan da v√¶re nettverksbaserte maskiner som domene kontrollere eller andre typer maskiner. Print Spooler tjenesten kj√∏rer som standard. Svakheten er definert slik at man kan lage en egendefinert DLL fil (som gjenspeiler en Print Driver) som man kan f√• print tjenesten i Windows til √• importere under SYSTEM kontekst om Remote Printing tjenestne er aktivert. Denne egendefinerte DLL filen kan f.eks inneholde skjulte kommandoer for √• tildele f.eks lokal administrator tilgang. Basert p√• informasjon vi har tilgjengelig er det ingen aktive angrep som benytter seg av denne angrepsvektoren enn√•. Det krever tilgang til f.eks en maskin innenfor domenet for √• kunne utnytte seg av s√•rbarheten som en da autentisert bruker.\nL√∏sninger/Workarounds Microsoft har kommet med sikkerhetsoppdateringer som l√∏ser s√•rbarheten. Men pga flere s√•rbarheter som n√• blir avdekket i Print Spooler tjenesten, samt generell r√•d er at man deaktiverer Print Spooler tjenesten p√• maskiner som ikke har behov for den, som f.eks Domene kontrollere. Merk at sikkerhetsoppdateringene fra Microsoft krever omstart av maskinene som blir oppdatert.\n PowerShell eksempel  Stop-Service -Name Spooler -Force Set-Service -Name Spooler -StartupType Disabled Merk at ved √• deaktivere Print Spooler tjenesten vil stoppe muligheten for √• kj√∏re print jobber, dette omfatter ogs√• f.eks konvertering til PDF. For maskiner hvor man har behov for print som f.eks Citrix servere eller lokale arbeidsstasjoner er det anbefalt at man deaktiverer inbound remote print for √• kunne\nMer informasjon  Eksempler p√• exploit https://github.com/nemo-wq/PrintNightmare-CVE-2021-34527 Her er ogs√• et eksempel p√• hvordan man kan koble opp til en ekstern fiktiv print tjeneste som deretter gir System tilganger p√• maskinen. Merk at skaperen bak Mimikatz skriver ogs√• hvordan man kan begrense dette til kun godkjente systemer ogs√• via Group Policy. Want to test #printnightmare (ep 4.x) user-to-system as a service?ü•ù\n(POC only, will write a log file to system32)\nconnect to \\\\https://t.co/6Pk2UnOXaG with\n- user: .\\gentilguest\n- password: password\nOpen \u0026#39;Kiwi Legit Printer - x64\u0026#39;, then \u0026#39;Kiwi Legit Printer - x64 (another one)\u0026#39; pic.twitter.com/zHX3aq9PpM\n\u0026mdash; ü•ù Benjamin Delpy (@gentilkiwi) July 17, 2021    ","permalink":"https://trusselsky.github.io/posts/printnightmare/","summary":"Hva er det? Den 30 Juli, ble det avdekket en s√•rbarhet i Print Spooler tjenesten i Windows. Som er en innebygget tjeneste i Windows som h√•ndterer utskrift samt er ogs√• ansvarlig for driver innstallasjon knyttet til oppkobling av skrivere p√• Windows operativsystem.\nDet har kommet en del informasjon knyttet til denne s√•rbarheten samtidig som den er veldig omfattende og dekkes av flere CVE\u0026rsquo;er.\n1: CVE-2021-1675 (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675) som ikke er s√•rbarheten dubbet PrintNightmare.","title":"PrintNightmare - CVE-2021-34527"},{"content":"Hva er det? Den 19 Juli, ble det avdekket en s√•rbarhet i SAM (Security Account Manager) databasen i Windows 10 p√• nyere versjoner. Denne s√•rbarheten gjorde at brukerdatabasen kunne bli lest av ikke-administrator kontoer i Windows 10 under en gitt kontekst. Dette var kun mulig √• gj√∏re om det fantes VSS (Volume Shadow Service) som oftest brukes for √• lage lokale snapshots i Windows (som f.eks Previous Versions). Om man har f.eks backup tjenester som brukes mot Windows 10 klient maskiner vil den ofte bruke VSS for √• lage snapshots. Samt f.eks System Restore funksjonen i Windows bruker VSS for √• lage snapshosts.\nS√•rbarheten ble avdekket av Jonas Lyk (https://twitter.com/jonasLyk/status/1417205166172950531)\nHvilken versjoner gjelder det? Dette gjelder Windows 10 (fra 1809 oppover) samt Windows Server 2019. S√•rbarheten er kun mulig √• utnytte om man har tilgang til √• kj√∏re kode p√• det aktuelle systemet.\nHvilken konsekvenser har det? Om en klient maskin blir kompromitert samt har shadow copies lokalt p√• maskinen, kan en angriper bruke dette for √• elevere seg selv til √• bli lokal administrator. Eller hente ut informasjon om andre brukerkontoer som ligger igjen lokalt, som f.eks domene kontoer.\nL√∏sninger/Workarounds Microsoft har ikke kommet med patch enn√•, men det finnes en workaround for √• kunne l√∏se opp i s√•rbarheten. Samtidig er det viktig √• p√•peke at s√•rbarheten ikke blir aktivt utnyttet enn√•, men at Microsoft vil komme med en oppdatering fortl√∏pende.\n Begrens tilgang til SAM databasen, kj√∏r CMD/PowerShell som Administrator icacls %windir%\\system32\\config*.* /inheritance:e Slett tidligere Shadow Copies som ble laget f√∏r punkt 1 ble gjort. Her er mer informasjon knyttet til hvordan finne og slette Shadow Copies \u0026ndash;\u0026gt; https://support.microsoft.com/en-gb/topic/kb5005357-delete-volume-shadow-copies-1ceaa637-aaa3-4b58-a48b-baf72a2fa9e7  Mer informasjon  Microsoft CVE-2021-36934 (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36934) Python PoC (https://github.com/GossiTheDog/HiveNightmare)  Video av Exploit   ","permalink":"https://trusselsky.github.io/posts/serioussam/","summary":"Hva er det? Den 19 Juli, ble det avdekket en s√•rbarhet i SAM (Security Account Manager) databasen i Windows 10 p√• nyere versjoner. Denne s√•rbarheten gjorde at brukerdatabasen kunne bli lest av ikke-administrator kontoer i Windows 10 under en gitt kontekst. Dette var kun mulig √• gj√∏re om det fantes VSS (Volume Shadow Service) som oftest brukes for √• lage lokale snapshots i Windows (som f.eks Previous Versions). Om man har f.","title":"Serious Sam - CVE-2021-36934"}]